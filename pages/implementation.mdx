---
title: ğŸ¼ å®ç°åŸç†
---

> æœ¬æ–‡ä¸»è¦è®²è¿° mincu ä¸»è¦éƒ¨åˆ†çš„å®ç°åŸç†ï¼Œå…³äº debug å·¥å…·çš„åŸç†ï¼Œè§ [è°ƒè¯•æŒ‡å—](/debug)

## ğŸ—º æ€»è§ˆ
æˆ‘ä»¬éœ€è¦å®ç°çš„éœ€æ±‚æ˜¯ï¼š

1. åœ¨ Web ä¸­å‘é€ä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åå®¹å™¨åˆ™ç›‘å¬åˆ°äº†è¯¥äº‹ä»¶ï¼›
2. å®¹å™¨å°†è¯¥äº‹ä»¶æ‰€å¯¹åº”çš„æ–¹æ³•æ‰§è¡Œï¼Œå¹¶ç»™å‡ºè¿”å›å€¼ï¼ˆæˆ–è€…è°ƒç”¨å®Œæ¯•çš„ä¿¡å·ï¼‰ï¼›
3. å®¹å™¨å°†äº‹ä»¶æ‰€å¯¹åº”çš„è¿”å›å€¼ï¼ˆæˆ–è€…è°ƒç”¨å®Œæ¯•çš„ä¿¡å·ï¼‰å†ä¼ ç»™ Webï¼›
4. Web æ¥æ”¶åˆ°ç»“æœï¼Œå¹¶å“åº”ç»™äº‹ä»¶å¯¹åº”çš„å‡½æ•°ã€‚


åœ¨ä»¥ä¸Šçš„æµç¨‹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è¦å­˜åœ¨ä¸€æ­¥å°†å¯¹åº”çš„ runtime æ³¨å…¥åˆ° Web ä¸­çš„æµç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼Œå¦‚ä½•å°†æ‰¿è½½ä»¥ä¸Šé€»è¾‘çš„åº•å±‚ä»£ç æ³¨å…¥åˆ°å®¹å™¨æ‰€åŒ…è£¹çš„ Web ä¸­ï¼Œå¹¶ä¸” Web èƒ½å¤ŸçŸ¥é“è‡ªå·±å¤„åœ¨äº†è¿™ä¸ªç‰¹æ®Šçš„ç¯å¢ƒä¹‹ä¸­ã€‚

## â˜ï¸ å¦‚ä½•åšåˆ°é€šä¿¡

ä¸»è¦ä½¿ç”¨äº† [react-native-webview](https://github.com/react-native-webview/react-native-webview) çš„å››ä¸ªåŸºæœ¬çš„é€šä¿¡ APIï¼š

1. **React Native -> Web**: The `injectedJavaScript` prop
2. **React Native -> Web**: The `injectJavaScript` method
3. **Web -> React Native**: The `postMessage` method and `onMessage` prop

æ ¹æ®ä¸Šè¿° APIï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹çš„é€šä¿¡èƒ½åŠ›è§£å†³æ–¹æ¡ˆ:

<br />

![communication.png](../public/impl/communication.png)

## ğŸ« ç¬¬ä¸€æ¬¡å¯åŠ¨

ä¸ºä»€ä¹ˆè¦å°†æ•´ä¸ªæµç¨‹åˆ†ä¸º**ç¬¬ä¸€æ¬¡å¯åŠ¨**ä¸**æ­£å¸¸æƒ…å†µè°ƒç”¨**å‘¢ï¼Ÿ<br />é¦–å…ˆä¸€å¼€å§‹å­˜åœ¨ä¸¤ä¸ªé—®é¢˜æ— æ³•å›é¿ï¼š

1. å®¹å™¨æ³¨å…¥ Web çš„æ€§èƒ½ï¼ˆæ—¶é—´ï¼‰ä¸ç¨³å®š
1. Web è·å–æ˜¯å¦æ³¨å…¥æˆåŠŸçš„æ‰‹æ®µ**åªèƒ½é€šè¿‡ Web ä¸»åŠ¨è·å–**

**æ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™é‡‡ç”¨äº† Web ç«¯è½®è¯¢æ–¹æ¡ˆï¼Œä»¥åˆ¤æ–­æ˜¯å¦åœ¨ mincu å®¹å™¨ç¯å¢ƒä¸­ã€‚**

ä¸‹é¢æµç¨‹å›¾ï¼Œå³å½“ç”¨æˆ·é€šè¿‡å—å¤§å®¶å›­æ‰“å¼€ä½¿ç”¨äº† mincu çš„åº”ç”¨å¹¶è¿›å…¥åº”ç”¨é¡µé¢æ—¶æ‰€å‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…ï¼š

<br />

![startup.png](../public/impl/startup.png)

## ğŸš¥ ä¸€èˆ¬æƒ…æ™¯çš„è°ƒç”¨é“¾è·¯

è¿™é‡Œæˆ‘ä»¬å·²ç»é€šè¿‡è½®è¯¢çš„æ–¹å¼è¿›å…¥äº† mincu ç¯å¢ƒäº†ï¼Œä½†å¦‚ä½•åœ¨ mincu ç¯å¢ƒä¸‹è°ƒç”¨åŸç”Ÿ API å¹¶è·å¾—å®ƒçš„è¿”å›å€¼å‘¢ï¼Ÿæˆ‘ä»¬ç»™å‡ºäº†å¦‚ä¸‹çš„æ–¹æ¡ˆã€‚

<br />

![path.png](../public/impl/path.png)

## ğŸ‘¯â€â™‚ï¸ åŒå‘é€šä¿¡

### å››ç§é€šä¿¡æƒ…å†µ

æˆ‘ä»¬æ‰€æœ‰çš„é€šä¿¡éƒ½å¯ä»¥åˆ†ä¸ºä¸€ä¸‹å››ç§æƒ…å†µï¼š

1. **Web å¯¹å®¢æˆ·ç«¯é€šä¿¡**: Web ç›´æ¥ call å®¢æˆ·ç«¯ï¼Œä½†æ— æ³•çŸ¥æ™“å®¢æˆ·ç«¯å¯¹è¯¥äº‹ä»¶ / æ–¹æ³•çš„å¤„ç†çŠ¶æ€ï¼›

2. **å®¢æˆ·ç«¯å¯¹ Web é€šä¿¡**: å®¢æˆ·ç«¯ç›´æ¥ call Webï¼Œä½†æ— æ³•çŸ¥æ™“ Web å¯¹è¯¥äº‹ä»¶ / æ–¹æ³•çš„å¤„ç†çŠ¶æ€ï¼›

3. **Web å¯¹å®¢æˆ·ç«¯é€šä¿¡ï¼Œä¸” Web èƒ½å¤Ÿè·å–å®¢æˆ·ç«¯ç»™çš„å€¼**: æœ€ä¸ºå¸¸è§çš„æƒ…å†µï¼Œå®ƒçš„è§£æ³•åŸºæœ¬ä¸Šéœ€è¦å°†ç¬¬ä¸€ç§æƒ…å†µçš„è§£å†³æ–¹æ¡ˆæ­é…ç¬¬äºŒç§æƒ…å†µçš„è§£å†³æ–¹æ¡ˆæ‰å¯å®ç°ï¼Œä¹‹å‰æˆ‘ä»¬ä¸€ç›´è®¨è®ºçš„ä¹Ÿæ˜¯è¿™ä¸ªæƒ…å†µï¼›

4. **å®¢æˆ·ç«¯å¯¹ Web é€šä¿¡ï¼Œä¸”å®¢æˆ·ç«¯èƒ½å¤Ÿè·å– Web ç»™çš„å€¼**: æœ€ä¸å¸¸ç”¨ / åŸºæœ¬æ²¡æœ‰ç”¨åˆ°ã€‚


### ä¸šåŠ¡åœºæ™¯

è€Œæˆ‘ä»¬ mincu åŸºæœ¬ä¸Šæ‰€æœ‰å¯¹ç”¨æˆ·é€å‡ºçš„ API éƒ½æ˜¯**ç¬¬ä¸‰ç§æƒ…å†µ**ï¼Œæœ‰æå°éƒ¨åˆ†æ˜¯**ç¬¬äºŒç§æƒ…å†µ**ï¼ˆå¦‚å®¢æˆ·ç«¯åˆ‡æ¢é»‘å¤œæ¨¡å¼ï¼Œmincu åº”ç”¨ä¹Ÿè¦éšç€å®¢æˆ·ç«¯é…ç½®æ¥åˆ‡æ¢ä¸»é¢˜ï¼‰

#### Native -> Web ï¼ˆç¬¬äºŒç§æƒ…å†µï¼‰

```tsx
import { useNativeState } from 'mincu-react' // or mincu-hooks

const App = () => {
  // å·²åˆå§‹åŒ–
  
  // ä½¿ç”¨ Native å¯¹ Web çš„é€šä¿¡å®ç°é¢œè‰²ä¸»é¢˜çŠ¶æ€å…±äº«
  // æ¥æ”¶ Native ç«¯å·²æ³¨å†Œçš„å¯å…±äº«çŠ¶æ€çš„å˜åŒ–
  const colorScheme = useNativeState('colorScheme')

  return <div>Current Theme is {colorScheme}</div>
}
```

#### Web -> Nativeï¼ˆç¬¬ä¸‰ç§æƒ…å†µï¼‰

```tsx
import { networkModule } from 'mincu-react' // or mincu-network

const App = () => {
  // å·²åˆå§‹åŒ–
  
  const refreshToken = async () => {
    // å‘ Native é€šä¿¡ï¼Œå¹¶è·å– Native ç«¯çš„è¿”å›å€¼
    const token = await networkModule.refreshToken()
    alert(token)
  }

  return <button onClick={refreshToken}>åˆ·æ–° token</button>
}
```

## ğŸ“¦ å…¶ä»–

### 1. æ³¨å…¥ä¼˜åŒ–

åœ¨ Web è°ƒç”¨æ–¹æ³•åä»åŸç”Ÿæ‹¿å»è¿”å›å€¼çš„åœºæ™¯é‡Œï¼Œæˆ‘ä»¬ç»å¸¸è¦ç”¨åˆ° `injectJavaScript` æ–¹æ³•æ¥åŠ¨æ€æ³¨å…¥ JS ä»£ç ï¼Œæ‰€ä»¥æé«˜å…¶ JS æ³¨å…¥æ•ˆç‡æ˜¯æé«˜è°ƒç”¨ API è°ƒç”¨æ€§èƒ½çš„å…³é”®ã€‚<br />åœ¨æˆ‘ä»¬å®è·µä¸­å‘ç°ï¼Œå®‰å“ç«¯çš„ mincu æ€§èƒ½è¡¨ç°åœ¨ä¸€äº›æ–¹é¢æ¯” iOS ç«¯çš„ç¨å·®ä¸€äº›ï¼Œæ‰€ä»¥ç»è¿‡ä¸€äº›è°ƒç ”ï¼Œä¸ºäº†æƒ³åŠæ³•æé«˜`injectJavaScript` çš„åŠ¨æ€æ³¨å…¥ JS çš„æ•ˆç‡ï¼Œæˆ‘ä»¬åŸºäº [patch-package](https://github.com/ds300/patch-package) å°†å®‰å“åŸç”Ÿçš„ä¸€éƒ¨åˆ†ä»£ç è¿›è¡Œäº†ä¿®æ”¹ã€‚

ä¸»è¦é€»è¾‘ï¼š

```java
@ReactMethod
public void injectJavaScriptExperimental(int reactTag, String js) {
  UIManagerModule uiManagerModule = getReactApplicationContext().getNativeModule(UIManagerModule.class);
  if (uiManagerModule != null) {
    RNCWebViewManager.RNCWebView webView = (RNCWebViewManager.RNCWebView) uiManagerModule.resolveView(reactTag);
    webView.post(() -> webView.evaluateJavascriptWithFallback(js));
   }
}
```

å…·ä½“æ³¨å…¥æ–¹æ³•è¯·æŸ¥çœ‹ï¼š[react-native-webview+11.17.1.patch](https://github.com/ncuhome/iNCU/blob/dev/patches/react-native-webview%2B11.17.1.patch)

```diff
diff --git a/node_modules/react-native-webview/android/src/main/java/com/reactnativecommunity/webview/RNCWebViewModule.java b/node_modules/react-native-webview/android/src/main/java/com/reactnativecommunity/webview/RNCWebViewModule.java
index 34fd44b..eda1b4b 100644
--- a/node_modules/react-native-webview/android/src/main/java/com/reactnativecommunity/webview/RNCWebViewModule.java
+++ b/node_modules/react-native-webview/android/src/main/java/com/reactnativecommunity/webview/RNCWebViewModule.java
@@ -22,6 +22,7 @@ import android.util.Log;
 import android.webkit.MimeTypeMap;
 import android.webkit.ValueCallback;
 import android.webkit.WebChromeClient;
+import android.webkit.WebView;
 import android.widget.Toast;
 
 import com.facebook.react.bridge.ActivityEventListener;
@@ -32,6 +33,7 @@ import com.facebook.react.bridge.ReactMethod;
 import com.facebook.react.module.annotations.ReactModule;
 import com.facebook.react.modules.core.PermissionAwareActivity;
 import com.facebook.react.modules.core.PermissionListener;
+import com.facebook.react.uimanager.UIManagerModule;
 
 import java.io.File;
 import java.io.IOException;
@@ -149,6 +151,15 @@ public class RNCWebViewModule extends ReactContextBaseJavaModule implements Acti
     }
   }
 
+  @ReactMethod
+  public void injectJavaScriptExperimental(int reactTag, String js) {
+    UIManagerModule uiManagerModule = getReactApplicationContext().getNativeModule(UIManagerModule.class);
+    if (uiManagerModule != null) {
+      RNCWebViewManager.RNCWebView webView = (RNCWebViewManager.RNCWebView) uiManagerModule.resolveView(reactTag);
+      webView.post(() -> webView.evaluateJavascriptWithFallback(js));
+    }
+  }
+
   public void onActivityResult(Activity activity, int requestCode, int resultCode, Intent data) {
 
     if (filePathCallback == null && filePathCallbackLegacy == null) {
diff --git a/node_modules/react-native-webview/lib/WebView.android.js b/node_modules/react-native-webview/lib/WebView.android.js
index 64025cd..ad8892e 100644
--- a/node_modules/react-native-webview/lib/WebView.android.js
+++ b/node_modules/react-native-webview/lib/WebView.android.js
@@ -127,7 +127,11 @@ var WebView = /** @class */ (function (_super) {
          * functionality, look into postMessage/onMessage.
          */
         _this.injectJavaScript = function (data) {
-            UIManager.dispatchViewManagerCommand(_this.getWebViewHandle(), _this.getCommands().injectJavaScript, [data]);
+            const tag = _this.webViewRef.current._nativeTag
+            if (tag) {
+                NativeModules.RNCWebView.injectJavaScriptExperimental(tag, data)
+            }
+            // UIManager.dispatchViewManagerCommand(_this.getWebViewHandle(), _this.getCommands().injectJavaScript, [data]);
         };
         /**
          * We return an event with a bunch of fields including:
```

### 2. å…³äºç™½åå•

ç™½åå•æ˜¯éš”ç¦»ä¸€èˆ¬ Webview ç¯å¢ƒä¸ mincu ç¯å¢ƒçš„ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œä¹‹æ‰€ä»¥è¦æœ‰ç™½åå•ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¼€æ”¾äº†å—å¤§å®¶å›­çš„æ‰«ç èƒ½åŠ›ä¸ deep link åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…äº§ç”Ÿå®‰å…¨é£é™©ï¼Œæˆ‘ä»¬å°†å®¹å™¨æ³¨å…¥ mincu runtime å‰å¢åŠ äº†è¿™ä¸€å¡å£ã€‚

ç™½åå•ç³»ç»Ÿä¼šé»˜è®¤æ”¾è¡Œ *.ncuos.com çš„åŸŸåè¿›å…¥ mincu ç¯å¢ƒä¸­ï¼Œå…¶ä»–åŸŸåéƒ½ä¸ä¼šè¢«æ³¨å…¥ mincu runtimeã€‚

<br />

![whitelist.png](../public/impl/whitelist.png)

è€Œç›®å‰æ­£å¼ç‰ˆå®¢æˆ·ç«¯ç»•è¿‡ç™½åå•çš„æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š

1. è¿›å…¥ã€Œå¼€å‘è€…æ¨¡å¼ã€ï¼Œå¦‚ä½•è¿›å…¥è¯¥æ¨¡å¼ä¼šåœ¨å¦ä¸€ç¯‡ã€Œå¼€å‘ä¸è°ƒè¯•æŒ‡å¼•ã€ä¸­ç»™å‡ºï¼Œè¿™ä¸ªé€‚åˆå¼€å‘è€…å¯¹ mincu app è¿›è¡Œè°ƒè¯•ï¼›

2. é€šè¿‡å—å¤§å®¶å›­å¾®åº”ç”¨æˆæƒä¸­è½¬é¡µï¼Œåœ¨ä¸­è½¬é¡µç§ï¼Œå°†å¤–éƒ¨çš„ url æ³¨å…¥åˆ°å®¢æˆ·ç«¯ç™½åå•ç³»ç»Ÿé‡Œï¼Œç„¶åå†è¿›è¡Œè·³è½¬ï¼Œè¿™ç§æƒ…å†µé€‚ç”¨äºå¤–éƒ¨å¼€å‘è€…å»éƒ¨ç½²è‡ªå·±çš„ mincu appã€‚



